<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>New Age - Busca Rápida de Pacotes</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    header { padding: 10px; background-color: #f0f0f0; }
    label { margin-right: 15px; }
    select { margin-right: 15px; }
    main { margin-top: 20px; }
    .product-link { display: block; margin: 5px 0; }
  </style>
</head>
<body>

<header>
  <!-- Botões de rádio para Nacional/Internacional -->
  <label><input type="radio" name="tipo" value="Nacional" checked> Nacional</label>
  <label><input type="radio" name="tipo" value="Internacional"> Internacional</label>
  <!-- Drop-down de SELO -->
  <label>Selecione o tema do produto:
    <select id="seloFilter">
      <option value="">Todos</option>
    </select>
  </label>
  <!-- Drop-down de CIDADE -->
  <label>Selecione o destino:
    <select id="cidadeFilter">
      <option value="">Todas</option>
    </select>
  </label>
</header>

<main id="productList">
  <!-- Lista de produtos será inserida aqui -->
</main>
<script>
document.addEventListener("DOMContentLoaded", () => {

  const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTb1zysM4bYEW5-jYTOkRCweXZ_-fYsW2ekQWznXYIP8o70TD-yp8rYWdr6dS56u3T_llhn5YlyRHAR/pub?output=tsv";

  let data = [];

  function clean(text) {
    return text
      .replace(/\uFEFF/g, "")      // remove BOM
      .replace(/^"+|"+$/g, "")     // remove aspas externas
      .trim();
  }

  fetch(SHEET_URL)
  .then(r => r.text())
  .then(text => {
    console.log("DADOS BRUTOS:", text);
  })
  .catch(e => console.error("ERRO FETCH:", e));
  
      data = lines.map(line => {
        const values = line.split("\t").map(v => clean(v));
        let obj = {};
        headers.forEach((h, i) => obj[h] = values[i] || "");
        obj.tipo = obj.PAIS.toUpperCase() === "BRASIL" ? "Nacional" : "Internacional";
        return obj;
      });

      initFilters();
      render();
    });

  function initFilters() {
    const seloSel = document.getElementById("seloFilter");
    const cidadeSel = document.getElementById("cidadeFilter");

    [...new Set(data.map(d => d.SELO).filter(Boolean))].forEach(v => {
      seloSel.appendChild(new Option(v, v));
    });

    [...new Set(data.map(d => d.CIDADE).filter(Boolean))].forEach(v => {
      cidadeSel.appendChild(new Option(v, v));
    });

    document.querySelectorAll('input[name="tipo"]').forEach(r => r.addEventListener("change", render));
    seloSel.addEventListener("change", render);
    cidadeSel.addEventListener("change", render);
  }

  function render() {
    const tipo = document.querySelector('input[name="tipo"]:checked').value;
    const selo = document.getElementById("seloFilter").value;
    const cidade = document.getElementById("cidadeFilter").value;
    const list = document.getElementById("productList");
    list.innerHTML = "";

    data.filter(d =>
      d.tipo === tipo &&
      (!selo || d.SELO === selo) &&
      (!cidade || d.CIDADE === cidade)
    ).forEach(d => {
      const a = document.createElement("a");
      a.className = "product-link";
      a.textContent = d.PRODUTO;
      a.href = encodeURI(d.LINK);
      a.target = "_blank";
      list.appendChild(a);
    });
  }
});
</script>

</body>
</html>
