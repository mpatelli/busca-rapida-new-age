<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>New Age - Busca Rápida de Pacotes</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    header { padding: 10px; background-color: #f0f0f0; }
    label { margin-right: 15px; }
    select { margin-right: 15px; }
    main { margin-top: 20px; }
    .product-link { display: block; margin: 5px 0; }
  </style>
</head>
<body> 

<header>
  <!-- Botões de rádio para Nacional/Internacional -->
  <label><input type="radio" name="tipo" value="Nacional" checked> Nacional</label>
  <label><input type="radio" name="tipo" value="Internacional"> Internacional</label>
  <!-- Drop-down de SELO -->
  <label>Selecione o tema do produto:
    <select id="seloFilter">
      <option value="">Todos</option>
    </select>
  </label>
  <!-- Drop-down de CIDADE -->
  <label>Selecione o destino:
    <select id="cidadeFilter">
      <option value="">Todas</option>
    </select>
  </label>
</header>

<main id="productList">
  <!-- Lista de produtos será inserida aqui -->
</main>
<script>
document.addEventListener("DOMContentLoaded", () => {

  const CSV_URL = "base_produtos.csv";
  let rows = [];

  fetch(CSV_URL)
    .then(r => r.text())
    .then(text => {
      const lines = text.split(/\r?\n/).filter(l => l.trim());
      const headers = lines.shift().split(",").map(h => h.trim());

      rows = lines.map(l => {
        const v = l.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g) || [];
        let o = {};
        headers.forEach((h,i) => o[h] = (v[i]||"").replace(/^"|"$/g,"").trim());
        o.tipo = o.PAIS.toUpperCase()==="BRASIL" ? "Nacional" : "Internacional";
        return o;
      });

      init();
      render();
    });

  function init(){
    const selo = document.getElementById("seloFilter");
    const cidade = document.getElementById("cidadeFilter");

    [...new Set(rows.map(r=>r.SELO).filter(Boolean))].forEach(v=>selo.add(new Option(v,v)));
    [...new Set(rows.map(r=>r.CIDADE).filter(Boolean))].forEach(v=>cidade.add(new Option(v,v)));

    document.querySelectorAll('input[name="tipo"]').forEach(r=>r.onchange=render);
    selo.onchange=render;
    cidade.onchange=render;
  }

  function render(){
    const tipo = document.querySelector('input[name="tipo"]:checked').value;
    const selo = document.getElementById("seloFilter").value;
    const cidade = document.getElementById("cidadeFilter").value;
    const out = document.getElementById("productList");
    out.innerHTML = "";

    rows.filter(r=>
      r.tipo===tipo &&
      (!selo || r.SELO===selo) &&
      (!cidade || r.CIDADE===cidade)
    ).forEach(r=>{
      const a = document.createElement("a");
      a.href = r.LINK;
      a.textContent = r.PRODUTO;
      a.target="_blank";
      a.className="product-link";
      out.appendChild(a);
    });
  }
});
</script>


</body>
</html>
